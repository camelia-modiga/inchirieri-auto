<?xml version = '1.0' encoding = 'UTF-8'?>
<TriggerOraclev10g class="oracle.dbtools.crest.model.design.storage.oracle.v10g.TriggerOraclev10g" name="contracte_data_inchiriere_trg" directorySegmentName="seg_0" id="B3E7289C-FFEC-8A2A-281F-AB7B6AB1F104">
<createdBy>Cami</createdBy>
<createdTime>2020-12-17 15:45:00 UTC</createdTime>
<ownerDesignName>proiect_pbd</ownerDesignName>
<actions>INSERT, UPDATE</actions>
<body><![CDATA[DECLARE
    ultima_data_retur DATE;
    v_nr_de_inchirieri NUMBER(4);
BEGIN  
    SELECT COUNT(*) INTO v_nr_de_inchirieri FROM Contracte_inchirieri WHERE id_masina = :new.id_masina;
    IF v_nr_de_inchirieri > 0 
    THEN
        SELECT MAX(data_retur) INTO ultima_data_retur FROM Contracte_inchirieri WHERE id_masina = :new.id_masina;
        IF (:new.data_inchiriere < ultima_data_retur)
        THEN
            RAISE_APPLICATION_ERROR( -20001,
                    'Data invalida: ' || TO_CHAR( :new.data_inchiriere, 'DD.MM.YYYY' ) || ' trebuie sa fie mai mare decat data_retur anterioara.' );
        END IF;
    END IF;
END;]]></body>
<triggerTime>BEFORE</triggerTime>
</TriggerOraclev10g>